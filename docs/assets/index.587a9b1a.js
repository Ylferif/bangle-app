const pe=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}};pe();function v(){}function ie(e){return e()}function V(){return Object.create(null)}function O(e){e.forEach(ie)}function me(e){return typeof e=="function"}function z(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function he(e){return Object.keys(e).length===0}function p(e,t){e.appendChild(t)}function B(e,t,n){e.insertBefore(t,n||null)}function C(e){e.parentNode.removeChild(e)}function g(e){return document.createElement(e)}function A(e){return document.createTextNode(e)}function $(){return A(" ")}function le(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function y(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function ge(e){return Array.from(e.childNodes)}function X(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function Y(e,t){e.value=t==null?"":t}function b(e,t,n,r){n===null?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function Z(e,t,n){e.classList[n?"add":"remove"](t)}let E;function x(e){E=e}function ce(){if(!E)throw new Error("Function called outside component initialization");return E}function _e(e){ce().$$.on_mount.push(e)}function ye(e){ce().$$.on_destroy.push(e)}const S=[],N=[],P=[],j=[],we=Promise.resolve();let T=!1;function be(){T||(T=!0,we.then(ue))}function F(e){P.push(e)}function ee(e){j.push(e)}const M=new Set;let L=0;function ue(){const e=E;do{for(;L<S.length;){const t=S[L];L++,x(t),$e(t.$$)}for(x(null),S.length=0,L=0;N.length;)N.pop()();for(let t=0;t<P.length;t+=1){const n=P[t];M.has(n)||(M.add(n),n())}P.length=0}while(S.length);for(;j.length;)j.pop()();T=!1,M.clear(),x(e)}function $e(e){if(e.fragment!==null){e.update(),O(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(F)}}const k=new Set;let ve;function I(e,t){e&&e.i&&(k.delete(e),e.i(t))}function te(e,t,n,r){if(e&&e.o){if(k.has(e))return;k.add(e),ve.c.push(()=>{k.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}else r&&r()}function ne(e,t,n){const r=e.$$.props[t];r!==void 0&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function re(e){e&&e.c()}function W(e,t,n,r){const{fragment:s,on_mount:o,on_destroy:a,after_update:d}=e.$$;s&&s.m(t,n),r||F(()=>{const l=o.map(ie).filter(me);a?a.push(...l):O(l),e.$$.on_mount=[]}),d.forEach(F)}function q(e,t){const n=e.$$;n.fragment!==null&&(O(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Se(e,t){e.$$.dirty[0]===-1&&(S.push(e),be(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function D(e,t,n,r,s,o,a,d=[-1]){const l=E;x(e);const i=e.$$={fragment:null,ctx:null,props:o,update:v,not_equal:s,bound:V(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:V(),dirty:d,skip_bound:!1,root:t.target||l.$$.root};a&&a(i.root);let u=!1;if(i.ctx=n?n(e,t.props||{},(c,f,...h)=>{const _=h.length?h[0]:f;return i.ctx&&s(i.ctx[c],i.ctx[c]=_)&&(!i.skip_bound&&i.bound[c]&&i.bound[c](_),u&&Se(e,c)),f}):[],i.update(),u=!0,O(i.before_update),i.fragment=r?r(i.ctx):!1,t.target){if(t.hydrate){const c=ge(t.target);i.fragment&&i.fragment.l(c),c.forEach(C)}else i.fragment&&i.fragment.c();t.intro&&I(e.$$.fragment),W(e,t.target,t.anchor,t.customElement),ue()}x(l)}class J{$destroy(){q(this,1),this.$destroy=v}$on(t,n){const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const s=r.indexOf(n);s!==-1&&r.splice(s,1)}}$set(t){this.$$set&&!he(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function xe(e,t){return e.write(`if(1){${t}}
`)}async function Ae(e){return xe(e,`
    (function(){
        const alarms = require("sched").getAlarms();
        Bluetooth.println(JSON.stringify({ t: 'alarms', alarms: alarms }));
    })();
`)}function Ee(e){let t,n,r,s,o,a,d,l,i,u;return{c(){t=g("div"),n=g("div"),r=g("h2"),r.textContent="Next Alarm",s=$(),o=g("span"),a=g("span"),d=A(`:\r
      `),l=g("span"),i=A(`:\r
      `),u=g("span"),y(r,"class","card-title"),b(a,"--value",e[0]),b(l,"--value",e[1]),b(u,"--value",e[2]),y(o,"class","countdown font-mono text-2xl"),y(n,"class","card-body"),y(t,"class","card w-96 bg-base-100 shadow-xl")},m(c,f){B(c,t,f),p(t,n),p(n,r),p(n,s),p(n,o),p(o,a),p(o,d),p(o,l),p(o,i),p(o,u)},p(c,[f]){f&1&&b(a,"--value",c[0]),f&2&&b(l,"--value",c[1]),f&4&&b(u,"--value",c[2])},i:v,o:v,d(c){c&&C(t)}}}function oe(){const e=new Date;return e.getHours()*1e3*60*60+e.getMinutes()*1e3*60+e.getSeconds()*1e3}function Ke(e,t,n){let{alarms:r=[]}=t,s,o=0,a=0,d=0,l;return _e(()=>{(function i(){if(s!==void 0){let u=s-oe();n(0,o=Math.floor(u/36e5)),u=u-o*36e5,n(1,a=Math.floor(u/6e4)),u=u-a*6e4,n(2,d=Math.floor(u/1e3))}l=setTimeout(i,1e3-Date.now()%1e3)})()}),ye(()=>clearTimeout(l)),e.$$set=i=>{"alarms"in i&&n(3,r=i.alarms)},e.$$.update=()=>{if(e.$$.dirty&8){const i=oe(),c=r.filter(f=>f.on&&f.t>i).sort((f,h)=>f.t-h.t)[0];c?s=c.t:(s=void 0,n(0,o=0),n(1,a=0),n(2,d=0))}},[o,a,d,r]}class Le extends J{constructor(t){super(),D(this,t,Ke,Ee,z,{alarms:3})}}async function Pe(e,t,n){return await e.write(`reset();
`),e.write(`require('Storage').write('${t}',atob("${btoa(n)}"));
`)}function ke(){return new Promise(e=>navigator.geolocation.getCurrentPosition(t=>{e({lat:t.coords.latitude,lon:t.coords.longitude})}))}async function se(e,t,n,r){const s=await fetch(`https://api.openweathermap.org/data/2.5/${e}?lat=${t}&lon=${n}&units=metric&appid=${r}`);if(!s.ok)throw new Error("Failed to fetch data");return s.json()}function ae(e){return{dt:e.dt*1e3,temp:e.main.temp,weather:e.weather[0].main,icon:e.weather[0].icon}}async function Ne(e,t){localStorage.setItem("weather-api-key",t);const{lat:n,lon:r}=await ke(),s=await se("forecast",n,r,t),o=await se("weather",n,r,t),a=[ae(o),...s.list.map(ae)],d={city:s.city.name,sunrise:s.city.sunrise,sunset:s.city.sunset},l={weather:a,location:d};await Pe(e,"my-clock-3.app.json",JSON.stringify(l))}function Oe(e){let t,n,r,s,o,a,d,l,i,u;return{c(){t=g("div"),n=g("div"),r=g("h2"),r.textContent="Weather",s=$(),o=g("div"),a=g("label"),a.innerHTML='<span class="label-text">API Key</span>',d=$(),l=g("input"),y(r,"class","card-title"),y(a,"class","label"),y(l,"class","input input-bordered w-full"),y(l,"type","text"),y(o,"class","form-control"),y(n,"class","card-body"),y(t,"class","card w-96 bg-base-100 shadow-xl")},m(c,f){B(c,t,f),p(t,n),p(n,r),p(n,s),p(n,o),p(o,a),p(o,d),p(o,l),Y(l,e[0]),i||(u=le(l,"input",e[1]),i=!0)},p(c,[f]){f&1&&l.value!==c[0]&&Y(l,c[0])},i:v,o:v,d(c){c&&C(t),i=!1,u()}}}function Ce(e,t,n){let{apiKey:r}=t;function s(){r=this.value,n(0,r)}return e.$$set=o=>{"apiKey"in o&&n(0,r=o.apiKey)},[r,s]}class Me extends J{constructor(t){super(),D(this,t,Ce,Oe,z,{apiKey:0})}}const je=window.Puck;function Te(e){return new Promise((t,n)=>je.connect(r=>{if(!r){n("Failed to connect");return}let s="";r.on("data",o=>{s+=o;const a=s.split(`
`);s=a.pop();for(const d of a)e(d)}),t(r)}))}function Fe(e){let t,n,r,s,o,a,d,l,i=e[0]?"Syncing...":"Sync",u,c,f,h,_,K,H;function fe(m){e[5](m)}let R={};e[1]!==void 0&&(R.apiKey=e[1]),n=new Me({props:R}),N.push(()=>ne(n,"apiKey",fe));function de(m){e[6](m)}let G={};return e[2]!==void 0&&(G.alarms=e[2]),o=new Le({props:G}),N.push(()=>ne(o,"alarms",de)),{c(){t=g("div"),re(n.$$.fragment),s=$(),re(o.$$.fragment),d=$(),l=g("button"),u=A(i),c=$(),f=g("div"),h=A(e[3]),y(l,"class","btn btn-primary"),Z(l,"loading",e[0]),y(f,"class","alert"),y(t,"class","flex flex-col justify-center items-center gap-8 p-10")},m(m,w){B(m,t,w),W(n,t,null),p(t,s),W(o,t,null),p(t,d),p(t,l),p(l,u),p(t,c),p(t,f),p(f,h),_=!0,K||(H=le(l,"click",e[4]),K=!0)},p(m,[w]){const Q={};!r&&w&2&&(r=!0,Q.apiKey=m[1],ee(()=>r=!1)),n.$set(Q);const U={};!a&&w&4&&(a=!0,U.alarms=m[2],ee(()=>a=!1)),o.$set(U),(!_||w&1)&&i!==(i=m[0]?"Syncing...":"Sync")&&X(u,i),w&1&&Z(l,"loading",m[0]),(!_||w&8)&&X(h,m[3])},i(m){_||(I(n.$$.fragment,m),I(o.$$.fragment,m),_=!0)},o(m){te(n.$$.fragment,m),te(o.$$.fragment,m),_=!1},d(m){m&&C(t),q(n),q(o),K=!1,H()}}}function Ie(e,t,n){var f;let r,s=!1,o=(f=localStorage.getItem("weather-api-key"))!=null?f:"",a=[],d="Ready";function l(h){let _;try{_=JSON.parse(h)}catch{console.warn("Could not parse message",h);return}switch(console.log("[command]",_),_.t){case"alarms":n(2,a=_.alarms);break}}async function i(){n(0,s=!0),r&&(r.close(),r=void 0),r=await Te(l);try{await Ae(r),await Ne(r,o),n(3,d="Syncronized Successfully")}catch(h){n(3,d="Syncronization Failed"),console.error(h)}finally{n(0,s=!1)}}function u(h){o=h,n(1,o)}function c(h){a=h,n(2,a)}return[s,o,a,d,i,u,c]}class We extends J{constructor(t){super(),D(this,t,Ie,Fe,z,{})}}new We({target:document.getElementById("app")});
