const we=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}};we();function $(){}function de(e){return e()}function ie(){return Object.create(null)}function W(e){e.forEach(de)}function ve(e){return typeof e=="function"}function S(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Se(e){return Object.keys(e).length===0}function xe(e,...t){if(e==null)return $;const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function te(e,t,n){e.$$.on_destroy.push(xe(t,n))}function u(e,t){e.appendChild(t)}function M(e,t,n){e.insertBefore(t,n||null)}function x(e){e.parentNode.removeChild(e)}function m(e){return document.createElement(e)}function _(e){return document.createTextNode(e)}function b(){return _(" ")}function pe(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function h(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Oe(e){return Array.from(e.childNodes)}function v(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function ae(e,t){e.value=t==null?"":t}function E(e,t,n,r){n===null?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function ce(e,t,n){e.classList[n?"add":"remove"](t)}let R;function H(e){R=e}function me(){if(!R)throw new Error("Function called outside component initialization");return R}function ke(e){me().$$.on_mount.push(e)}function Ee(e){me().$$.on_destroy.push(e)}const q=[],X=[],z=[],Y=[],Ne=Promise.resolve();let Z=!1;function Pe(){Z||(Z=!0,Ne.then(he))}function ee(e){z.push(e)}function Ae(e){Y.push(e)}const V=new Set;let J=0;function he(){const e=R;do{for(;J<q.length;){const t=q[J];J++,H(t),Ce(t.$$)}for(H(null),q.length=0,J=0;X.length;)X.pop()();for(let t=0;t<z.length;t+=1){const n=z[t];V.has(n)||(V.add(n),n())}z.length=0}while(q.length);for(;Y.length;)Y.pop()();Z=!1,V.clear(),H(e)}function Ce(e){if(e.fragment!==null){e.update(),W(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ee)}}const I=new Set;let Me;function P(e,t){e&&e.i&&(I.delete(e),e.i(t))}function L(e,t,n,r){if(e&&e.o){if(I.has(e))return;I.add(e),Me.c.push(()=>{I.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}else r&&r()}function Te(e,t,n){const r=e.$$.props[t];r!==void 0&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function B(e){e&&e.c()}function A(e,t,n,r){const{fragment:s,on_mount:o,on_destroy:a,after_update:l}=e.$$;s&&s.m(t,n),r||ee(()=>{const f=o.map(de).filter(ve);a?a.push(...f):W(f),e.$$.on_mount=[]}),l.forEach(ee)}function C(e,t){const n=e.$$;n.fragment!==null&&(W(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Ke(e,t){e.$$.dirty[0]===-1&&(q.push(e),Pe(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function T(e,t,n,r,s,o,a,l=[-1]){const f=R;H(e);const i=e.$$={fragment:null,ctx:null,props:o,update:$,not_equal:s,bound:ie(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(f?f.$$.context:[])),callbacks:ie(),dirty:l,skip_bound:!1,root:t.target||f.$$.root};a&&a(i.root);let p=!1;if(i.ctx=n?n(e,t.props||{},(c,d,...y)=>{const w=y.length?y[0]:d;return i.ctx&&s(i.ctx[c],i.ctx[c]=w)&&(!i.skip_bound&&i.bound[c]&&i.bound[c](w),p&&Ke(e,c)),d}):[],i.update(),p=!0,W(i.before_update),i.fragment=r?r(i.ctx):!1,t.target){if(t.hydrate){const c=Oe(t.target);i.fragment&&i.fragment.l(c),c.forEach(x)}else i.fragment&&i.fragment.c();t.intro&&P(e.$$.fragment),A(e,t.target,t.anchor,t.customElement),he()}H(f)}class K{$destroy(){C(this,1),this.$destroy=$}$on(t,n){const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const s=r.indexOf(n);s!==-1&&r.splice(s,1)}}$set(t){this.$$set&&!Se(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const N=[];function D(e,t=$){let n;const r=new Set;function s(l){if(S(e,l)&&(e=l,n)){const f=!N.length;for(const i of r)i[1](),N.push(i,e);if(f){for(let i=0;i<N.length;i+=2)N[i][0](N[i+1]);N.length=0}}}function o(l){s(l(e))}function a(l,f=$){const i=[l,f];return r.add(i),r.size===1&&(n=t(s)||$),l(e),()=>{r.delete(i),r.size===0&&(n(),n=null)}}return{set:s,update:o,subscribe:a}}const ge=D([]),ye=D(0),$e=D(0),_e=D({bpm:0,confidence:0});function Le(e){let t,n,r,s,o,a,l,f,i,p;return{c(){t=m("div"),n=m("div"),r=m("h2"),r.textContent="Next Alarm",s=b(),o=m("span"),a=m("span"),l=_(`:\r
      `),f=m("span"),i=_(`:\r
      `),p=m("span"),h(r,"class","card-title"),E(a,"--value",e[0]),E(f,"--value",e[1]),E(p,"--value",e[2]),h(o,"class","countdown font-mono text-2xl"),h(n,"class","card-body"),h(t,"class","card w-96 bg-base-100 shadow-xl")},m(c,d){M(c,t,d),u(t,n),u(n,r),u(n,s),u(n,o),u(o,a),u(o,l),u(o,f),u(o,i),u(o,p)},p(c,[d]){d&1&&E(a,"--value",c[0]),d&2&&E(f,"--value",c[1]),d&4&&E(p,"--value",c[2])},i:$,o:$,d(c){c&&x(t)}}}function ue(){const e=new Date;return e.getHours()*1e3*60*60+e.getMinutes()*1e3*60+e.getSeconds()*1e3}function Be(e,t,n){let r,s=0,o=0,a=0;const l=ge.subscribe(i=>{const p=ue(),d=i.filter(y=>y.on&&y.t>p).sort((y,w)=>y.t-w.t)[0];d?r=d.t:(r=void 0,n(0,s=0),n(1,o=0),n(2,a=0))});let f;return ke(()=>{(function i(){if(r!==void 0){let p=r-ue();n(0,s=Math.floor(p/36e5)),p=p-s*36e5,n(1,o=Math.floor(p/6e4)),p=p-o*6e4,n(2,a=Math.floor(p/1e3))}f=setTimeout(i,1e3-Date.now()%1e3)})()}),Ee(()=>{clearTimeout(f),l()}),[s,o,a]}class qe extends K{constructor(t){super(),T(this,t,Be,Le,S,{})}}const He=window.Puck;function j(e,t){return e.write(`if(1){${t}}
`)}function Re(e){return new Promise((t,n)=>He.connect(r=>{if(!r){n("Failed to connect");return}let s="";r.on("data",o=>{s+=o;const a=s.split(`
`);s=a.pop();for(const l of a)e(l)}),t(r)}))}function je(e){let t,n,r,s,o,a=e[0].bpm+"",l,f,i=e[0].confidence+"",p,c;return{c(){t=m("div"),n=m("div"),r=m("h2"),r.textContent="Heart Rate",s=b(),o=m("span"),l=_(a),f=_(" ("),p=_(i),c=_("%)"),h(r,"class","card-title"),h(n,"class","card-body"),h(t,"class","card w-96 bg-base-100 shadow-xl")},m(d,y){M(d,t,y),u(t,n),u(n,r),u(n,s),u(n,o),u(o,l),u(o,f),u(o,p),u(o,c)},p(d,[y]){y&1&&a!==(a=d[0].bpm+"")&&v(l,a),y&1&&i!==(i=d[0].confidence+"")&&v(p,i)},i:$,o:$,d(d){d&&x(t)}}}function Fe(e,t,n){let r;return te(e,_e,s=>n(0,r=s)),[r]}class Je extends K{constructor(t){super(),T(this,t,Fe,je,S,{})}}async function ze(e){return j(e,`
    (function(){
        const alarms = require("sched").getAlarms();
        Bluetooth.println(JSON.stringify({ t: 'alarms', alarms: alarms }));
    })();
`)}async function Ie(e){return j(e,`
    (function(){
        Bluetooth.println(JSON.stringify({ t: 'temperature', temperature: E.getTemperature() }));
    })();
`)}async function We(e){return j(e,`
    (function(){
        Bluetooth.println(JSON.stringify({ t: 'steps', steps: Bangle.getHealthStatus('day').steps }));
    })();
`)}async function De(e,t){let n=`
    Bangle.setHRMPower(true);
    Bangle.on('HRM', (hrm) => {
      Bluetooth.println(JSON.stringify({ t: 'hrm', hrm: {
        bpm: hrm.bpm,
        confidence: hrm.confidence
      } }));
    });
  `;return t&&(n+=`setTimeout(() => Bangle.setHRMPower(false), ${t})`),j(e,n)}function Ge(e){let t,n,r,s,o,a;return{c(){t=m("div"),n=m("div"),r=m("h2"),r.textContent="Steps",s=b(),o=m("span"),a=_(e[0]),h(r,"class","card-title"),h(n,"class","card-body"),h(t,"class","card w-96 bg-base-100 shadow-xl")},m(l,f){M(l,t,f),u(t,n),u(n,r),u(n,s),u(n,o),u(o,a)},p(l,[f]){f&1&&v(a,l[0])},i:$,o:$,d(l){l&&x(t)}}}function Qe(e,t,n){let r;return te(e,$e,s=>n(0,r=s)),[r]}class Ue extends K{constructor(t){super(),T(this,t,Qe,Ge,S,{})}}function Ve(e){let t,n,r,s,o,a=e[0]-6+"",l,f,i,p;return{c(){t=m("div"),n=m("div"),r=m("h2"),r.textContent="Temperature",s=b(),o=m("span"),l=_(a),f=_("\u2103 ("),i=_(e[0]),p=_("\u2103)"),h(r,"class","card-title"),h(n,"class","card-body"),h(t,"class","card w-96 bg-base-100 shadow-xl")},m(c,d){M(c,t,d),u(t,n),u(n,r),u(n,s),u(n,o),u(o,l),u(o,f),u(o,i),u(o,p)},p(c,[d]){d&1&&a!==(a=c[0]-6+"")&&v(l,a),d&1&&v(i,c[0])},i:$,o:$,d(c){c&&x(t)}}}function Xe(e,t,n){let r;return te(e,ye,s=>n(0,r=s)),[r]}class Ye extends K{constructor(t){super(),T(this,t,Xe,Ve,S,{})}}async function Ze(e,t,n){const r=`require('Storage').write('${t}',${n});`;return j(e,r)}function et(){return new Promise(e=>navigator.geolocation.getCurrentPosition(t=>{e({lat:t.coords.latitude,lon:t.coords.longitude})}))}async function le(e,t,n,r){const s=await fetch(`https://api.openweathermap.org/data/2.5/${e}?lat=${t}&lon=${n}&units=metric&appid=${r}`);if(!s.ok)throw new Error("Failed to fetch data");return s.json()}function fe(e){return{dt:e.dt*1e3,temp:e.main.temp,weather:e.weather[0].main,icon:e.weather[0].icon}}async function tt(e,t){localStorage.setItem("weather-api-key",t);const{lat:n,lon:r}=await et(),s=await le("forecast",n,r,t),o=await le("weather",n,r,t),a=[fe(o),...s.list.map(fe)],l={city:s.city.name,sunrise:s.city.sunrise,sunset:s.city.sunset},f={weather:a,location:l};await Ze(e,"my-clock-3.app.json",JSON.stringify(f))}function nt(e){let t,n,r,s,o,a,l,f,i,p;return{c(){t=m("div"),n=m("div"),r=m("h2"),r.textContent="Weather",s=b(),o=m("div"),a=m("label"),a.innerHTML='<span class="label-text">API Key</span>',l=b(),f=m("input"),h(r,"class","card-title"),h(a,"class","label"),h(f,"class","input input-bordered w-full"),h(f,"type","text"),h(o,"class","form-control"),h(n,"class","card-body"),h(t,"class","card w-96 bg-base-100 shadow-xl")},m(c,d){M(c,t,d),u(t,n),u(n,r),u(n,s),u(n,o),u(o,a),u(o,l),u(o,f),ae(f,e[0]),i||(p=pe(f,"input",e[1]),i=!0)},p(c,[d]){d&1&&f.value!==c[0]&&ae(f,c[0])},i:$,o:$,d(c){c&&x(t),i=!1,p()}}}function rt(e,t,n){let{apiKey:r}=t;function s(){r=this.value,n(0,r)}return e.$$set=o=>{"apiKey"in o&&n(0,r=o.apiKey)},[r,s]}class st extends K{constructor(t){super(),T(this,t,rt,nt,S,{apiKey:0})}}function ot(e){let t,n,r,s,o,a,l,f,i,p,c,d,y,w=e[0]?"Syncing...":"Sync",G,ne,F,Q,O,U,re;function be(g){e[4](g)}let se={};return e[1]!==void 0&&(se.apiKey=e[1]),n=new st({props:se}),X.push(()=>Te(n,"apiKey",be)),o=new qe({}),l=new Ye({}),i=new Ue({}),c=new Je({}),{c(){t=m("div"),B(n.$$.fragment),s=b(),B(o.$$.fragment),a=b(),B(l.$$.fragment),f=b(),B(i.$$.fragment),p=b(),B(c.$$.fragment),d=b(),y=m("button"),G=_(w),ne=b(),F=m("div"),Q=_(e[2]),h(y,"class","btn btn-primary"),ce(y,"loading",e[0]),h(F,"class","alert"),h(t,"class","flex flex-col justify-center items-center gap-8 p-10")},m(g,k){M(g,t,k),A(n,t,null),u(t,s),A(o,t,null),u(t,a),A(l,t,null),u(t,f),A(i,t,null),u(t,p),A(c,t,null),u(t,d),u(t,y),u(y,G),u(t,ne),u(t,F),u(F,Q),O=!0,U||(re=pe(y,"click",e[3]),U=!0)},p(g,[k]){const oe={};!r&&k&2&&(r=!0,oe.apiKey=g[1],Ae(()=>r=!1)),n.$set(oe),(!O||k&1)&&w!==(w=g[0]?"Syncing...":"Sync")&&v(G,w),k&1&&ce(y,"loading",g[0]),(!O||k&4)&&v(Q,g[2])},i(g){O||(P(n.$$.fragment,g),P(o.$$.fragment,g),P(l.$$.fragment,g),P(i.$$.fragment,g),P(c.$$.fragment,g),O=!0)},o(g){L(n.$$.fragment,g),L(o.$$.fragment,g),L(l.$$.fragment,g),L(i.$$.fragment,g),L(c.$$.fragment,g),O=!1},d(g){g&&x(t),C(n),C(o),C(l),C(i),C(c),U=!1,re()}}}function it(e,t,n){var p;let r,s=!1,o=(p=localStorage.getItem("weather-api-key"))!=null?p:"",a="Ready";function l(c){let d;try{d=JSON.parse(c)}catch{console.warn("Could not parse message",c);return}switch(console.log("[command]",d),d.t){case"alarms":ge.set(d.alarms);break;case"temperature":ye.set(d.temperature);break;case"steps":$e.set(d.steps);break;case"hrm":_e.set(d.hrm);break}}async function f(){n(0,s=!0),(!r||!r.isOpen)&&(r=await Re(l));try{await ze(r),await Ie(r),await We(r),await De(r,6e4),await tt(r,o),n(2,a="Syncronized Successfully")}catch(c){n(2,a="Syncronization Failed"),console.error(c)}finally{n(0,s=!1)}}function i(c){o=c,n(1,o)}return[s,o,a,f,i]}class at extends K{constructor(t){super(),T(this,t,it,ot,S,{})}}new at({target:document.getElementById("app")});
