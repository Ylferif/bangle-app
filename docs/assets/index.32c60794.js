const we=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}};we();function $(){}function de(e){return e()}function ie(){return Object.create(null)}function W(e){e.forEach(de)}function ve(e){return typeof e=="function"}function S(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Se(e){return Object.keys(e).length===0}function l(e,t){e.appendChild(t)}function M(e,t,n){e.insertBefore(t,n||null)}function x(e){e.parentNode.removeChild(e)}function m(e){return document.createElement(e)}function b(e){return document.createTextNode(e)}function _(){return b(" ")}function pe(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function h(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function xe(e){return Array.from(e.childNodes)}function v(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function ae(e,t){e.value=t==null?"":t}function E(e,t,n,r){n===null?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function ce(e,t,n){e.classList[n?"add":"remove"](t)}let R;function H(e){R=e}function me(){if(!R)throw new Error("Function called outside component initialization");return R}function Oe(e){me().$$.on_mount.push(e)}function D(e){me().$$.on_destroy.push(e)}const q=[],Y=[],z=[],Z=[],ke=Promise.resolve();let ee=!1;function Ee(){ee||(ee=!0,ke.then(he))}function te(e){z.push(e)}function Ne(e){Z.push(e)}const X=new Set;let J=0;function he(){const e=R;do{for(;J<q.length;){const t=q[J];J++,H(t),Pe(t.$$)}for(H(null),q.length=0,J=0;Y.length;)Y.pop()();for(let t=0;t<z.length;t+=1){const n=z[t];X.has(n)||(X.add(n),n())}z.length=0}while(q.length);for(;Z.length;)Z.pop()();ee=!1,X.clear(),H(e)}function Pe(e){if(e.fragment!==null){e.update(),W(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(te)}}const I=new Set;let Ae;function P(e,t){e&&e.i&&(I.delete(e),e.i(t))}function L(e,t,n,r){if(e&&e.o){if(I.has(e))return;I.add(e),Ae.c.push(()=>{I.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}else r&&r()}function Ce(e,t,n){const r=e.$$.props[t];r!==void 0&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function B(e){e&&e.c()}function A(e,t,n,r){const{fragment:o,on_mount:s,on_destroy:a,after_update:f}=e.$$;o&&o.m(t,n),r||te(()=>{const u=s.map(de).filter(ve);a?a.push(...u):W(u),e.$$.on_mount=[]}),f.forEach(te)}function C(e,t){const n=e.$$;n.fragment!==null&&(W(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Me(e,t){e.$$.dirty[0]===-1&&(q.push(e),Ee(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function T(e,t,n,r,o,s,a,f=[-1]){const u=R;H(e);const i=e.$$={fragment:null,ctx:null,props:s,update:$,not_equal:o,bound:ie(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:ie(),dirty:f,skip_bound:!1,root:t.target||u.$$.root};a&&a(i.root);let d=!1;if(i.ctx=n?n(e,t.props||{},(c,p,...y)=>{const w=y.length?y[0]:p;return i.ctx&&o(i.ctx[c],i.ctx[c]=w)&&(!i.skip_bound&&i.bound[c]&&i.bound[c](w),d&&Me(e,c)),p}):[],i.update(),d=!0,W(i.before_update),i.fragment=r?r(i.ctx):!1,t.target){if(t.hydrate){const c=xe(t.target);i.fragment&&i.fragment.l(c),c.forEach(x)}else i.fragment&&i.fragment.c();t.intro&&P(e.$$.fragment),A(e,t.target,t.anchor,t.customElement),he()}H(u)}class K{$destroy(){C(this,1),this.$destroy=$}$on(t,n){const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const o=r.indexOf(n);o!==-1&&r.splice(o,1)}}$set(t){this.$$set&&!Se(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const N=[];function V(e,t=$){let n;const r=new Set;function o(f){if(S(e,f)&&(e=f,n)){const u=!N.length;for(const i of r)i[1](),N.push(i,e);if(u){for(let i=0;i<N.length;i+=2)N[i][0](N[i+1]);N.length=0}}}function s(f){o(f(e))}function a(f,u=$){const i=[f,u];return r.add(i),r.size===1&&(n=t(o)||$),f(e),()=>{r.delete(i),r.size===0&&(n(),n=null)}}return{set:o,update:s,subscribe:a}}const ge=V([]),ye=V(0),$e=V(0),be=V({bpm:0,confidence:0});function Te(e){let t,n,r,o,s,a,f,u,i,d;return{c(){t=m("div"),n=m("div"),r=m("h2"),r.textContent="Next Alarm",o=_(),s=m("span"),a=m("span"),f=b(`:\r
      `),u=m("span"),i=b(`:\r
      `),d=m("span"),h(r,"class","card-title"),E(a,"--value",e[0]),E(u,"--value",e[1]),E(d,"--value",e[2]),h(s,"class","countdown font-mono text-2xl"),h(n,"class","card-body"),h(t,"class","card w-96 bg-base-100 shadow-xl")},m(c,p){M(c,t,p),l(t,n),l(n,r),l(n,o),l(n,s),l(s,a),l(s,f),l(s,u),l(s,i),l(s,d)},p(c,[p]){p&1&&E(a,"--value",c[0]),p&2&&E(u,"--value",c[1]),p&4&&E(d,"--value",c[2])},i:$,o:$,d(c){c&&x(t)}}}function le(){const e=new Date;return e.getHours()*1e3*60*60+e.getMinutes()*1e3*60+e.getSeconds()*1e3}function Ke(e,t,n){let r,o=0,s=0,a=0;const f=ge.subscribe(i=>{const d=le(),p=i.filter(y=>y.on&&y.t>d).sort((y,w)=>y.t-w.t)[0];p?r=p.t:(r=void 0,n(0,o=0),n(1,s=0),n(2,a=0))});let u;return Oe(()=>{(function i(){if(r!==void 0){let d=r-le();n(0,o=Math.floor(d/36e5)),d=d-o*36e5,n(1,s=Math.floor(d/6e4)),d=d-s*6e4,n(2,a=Math.floor(d/1e3))}u=setTimeout(i,1e3-Date.now()%1e3)})()}),D(()=>{clearTimeout(u),f()}),[o,s,a]}class Le extends K{constructor(t){super(),T(this,t,Ke,Te,S,{})}}const Be=window.Puck;function j(e,t){return e.write(`if(1){${t}}
`)}function qe(e){return new Promise((t,n)=>Be.connect(r=>{if(!r){n("Failed to connect");return}let o="";r.on("data",s=>{o+=s;const a=o.split(`
`);o=a.pop();for(const f of a)e(f)}),t(r)}))}function He(e){let t,n,r,o,s,a,f,u,i;return{c(){t=m("div"),n=m("div"),r=m("h2"),r.textContent="Heart Rate",o=_(),s=m("span"),a=b(e[0]),f=b(" ("),u=b(e[1]),i=b(")%"),h(r,"class","card-title"),h(n,"class","card-body"),h(t,"class","card w-96 bg-base-100 shadow-xl")},m(d,c){M(d,t,c),l(t,n),l(n,r),l(n,o),l(n,s),l(s,a),l(s,f),l(s,u),l(s,i)},p(d,[c]){c&1&&v(a,d[0]),c&2&&v(u,d[1])},i:$,o:$,d(d){d&&x(t)}}}function Re(e,t,n){let r=0,o=0;const s=be.subscribe(a=>{n(0,r=a.bpm),n(1,o=a.confidence)});return D(s),[r,o]}class je extends K{constructor(t){super(),T(this,t,Re,He,S,{})}}async function Fe(e){return j(e,`
    (function(){
        const alarms = require("sched").getAlarms();
        Bluetooth.println(JSON.stringify({ t: 'alarms', alarms: alarms }));
    })();
`)}async function Je(e){return j(e,`
    (function(){
        Bluetooth.println(JSON.stringify({ t: 'temperature', temperature: E.getTemperature() }));
    })();
`)}async function ze(e){return j(e,`
    (function(){
        Bluetooth.println(JSON.stringify({ t: 'steps', steps: Bangle.getHealthStatus('day').steps }));
    })();
`)}async function Ie(e,t){let n=`
    Bangle.setHRMPower(true);
    Bangle.on('HRM', (hrm) => {
      Bluetooth.println(JSON.stringify({ t: 'hrm', hrm: {
        bpm: hrm.bpm,
        confidence: hrm.confidence
      } }));
    });
  `;return t&&(n+=`setTimeout(() => Bangle.setHRMPower(false), ${t})`),j(e,n)}function We(e){let t,n,r,o,s,a;return{c(){t=m("div"),n=m("div"),r=m("h2"),r.textContent="Steps",o=_(),s=m("span"),a=b(e[0]),h(r,"class","card-title"),h(n,"class","card-body"),h(t,"class","card w-96 bg-base-100 shadow-xl")},m(f,u){M(f,t,u),l(t,n),l(n,r),l(n,o),l(n,s),l(s,a)},p(f,[u]){u&1&&v(a,f[0])},i:$,o:$,d(f){f&&x(t)}}}function De(e,t,n){let r=0;const o=$e.subscribe(s=>n(0,r=s));return D(o),[r]}class Ve extends K{constructor(t){super(),T(this,t,De,We,S,{})}}function Ge(e){let t,n,r,o,s,a=e[0]-6+"",f,u,i,d;return{c(){t=m("div"),n=m("div"),r=m("h2"),r.textContent="Temperature",o=_(),s=m("span"),f=b(a),u=b("\u2103 ("),i=b(e[0]),d=b("\u2103)"),h(r,"class","card-title"),h(n,"class","card-body"),h(t,"class","card w-96 bg-base-100 shadow-xl")},m(c,p){M(c,t,p),l(t,n),l(n,r),l(n,o),l(n,s),l(s,f),l(s,u),l(s,i),l(s,d)},p(c,[p]){p&1&&a!==(a=c[0]-6+"")&&v(f,a),p&1&&v(i,c[0])},i:$,o:$,d(c){c&&x(t)}}}function Qe(e,t,n){let r=0;const o=ye.subscribe(s=>n(0,r=s));return D(o),[r]}class Ue extends K{constructor(t){super(),T(this,t,Qe,Ge,S,{})}}async function Xe(e,t,n){const r=`require('Storage').write('${t}',${n});`;return j(e,r)}function Ye(){return new Promise(e=>navigator.geolocation.getCurrentPosition(t=>{e({lat:t.coords.latitude,lon:t.coords.longitude})}))}async function ue(e,t,n,r){const o=await fetch(`https://api.openweathermap.org/data/2.5/${e}?lat=${t}&lon=${n}&units=metric&appid=${r}`);if(!o.ok)throw new Error("Failed to fetch data");return o.json()}function fe(e){return{dt:e.dt*1e3,temp:e.main.temp,weather:e.weather[0].main,icon:e.weather[0].icon}}async function Ze(e,t){localStorage.setItem("weather-api-key",t);const{lat:n,lon:r}=await Ye(),o=await ue("forecast",n,r,t),s=await ue("weather",n,r,t),a=[fe(s),...o.list.map(fe)],f={city:o.city.name,sunrise:o.city.sunrise,sunset:o.city.sunset},u={weather:a,location:f};await Xe(e,"my-clock-3.app.json",JSON.stringify(u))}function et(e){let t,n,r,o,s,a,f,u,i,d;return{c(){t=m("div"),n=m("div"),r=m("h2"),r.textContent="Weather",o=_(),s=m("div"),a=m("label"),a.innerHTML='<span class="label-text">API Key</span>',f=_(),u=m("input"),h(r,"class","card-title"),h(a,"class","label"),h(u,"class","input input-bordered w-full"),h(u,"type","text"),h(s,"class","form-control"),h(n,"class","card-body"),h(t,"class","card w-96 bg-base-100 shadow-xl")},m(c,p){M(c,t,p),l(t,n),l(n,r),l(n,o),l(n,s),l(s,a),l(s,f),l(s,u),ae(u,e[0]),i||(d=pe(u,"input",e[1]),i=!0)},p(c,[p]){p&1&&u.value!==c[0]&&ae(u,c[0])},i:$,o:$,d(c){c&&x(t),i=!1,d()}}}function tt(e,t,n){let{apiKey:r}=t;function o(){r=this.value,n(0,r)}return e.$$set=s=>{"apiKey"in s&&n(0,r=s.apiKey)},[r,o]}class nt extends K{constructor(t){super(),T(this,t,tt,et,S,{apiKey:0})}}function rt(e){let t,n,r,o,s,a,f,u,i,d,c,p,y,w=e[0]?"Syncing...":"Sync",G,ne,F,Q,O,U,re;function _e(g){e[4](g)}let se={};return e[1]!==void 0&&(se.apiKey=e[1]),n=new nt({props:se}),Y.push(()=>Ce(n,"apiKey",_e)),s=new Le({}),f=new Ue({}),i=new Ve({}),c=new je({}),{c(){t=m("div"),B(n.$$.fragment),o=_(),B(s.$$.fragment),a=_(),B(f.$$.fragment),u=_(),B(i.$$.fragment),d=_(),B(c.$$.fragment),p=_(),y=m("button"),G=b(w),ne=_(),F=m("div"),Q=b(e[2]),h(y,"class","btn btn-primary"),ce(y,"loading",e[0]),h(F,"class","alert"),h(t,"class","flex flex-col justify-center items-center gap-8 p-10")},m(g,k){M(g,t,k),A(n,t,null),l(t,o),A(s,t,null),l(t,a),A(f,t,null),l(t,u),A(i,t,null),l(t,d),A(c,t,null),l(t,p),l(t,y),l(y,G),l(t,ne),l(t,F),l(F,Q),O=!0,U||(re=pe(y,"click",e[3]),U=!0)},p(g,[k]){const oe={};!r&&k&2&&(r=!0,oe.apiKey=g[1],Ne(()=>r=!1)),n.$set(oe),(!O||k&1)&&w!==(w=g[0]?"Syncing...":"Sync")&&v(G,w),k&1&&ce(y,"loading",g[0]),(!O||k&4)&&v(Q,g[2])},i(g){O||(P(n.$$.fragment,g),P(s.$$.fragment,g),P(f.$$.fragment,g),P(i.$$.fragment,g),P(c.$$.fragment,g),O=!0)},o(g){L(n.$$.fragment,g),L(s.$$.fragment,g),L(f.$$.fragment,g),L(i.$$.fragment,g),L(c.$$.fragment,g),O=!1},d(g){g&&x(t),C(n),C(s),C(f),C(i),C(c),U=!1,re()}}}function st(e,t,n){var d;let r,o=!1,s=(d=localStorage.getItem("weather-api-key"))!=null?d:"",a="Ready";function f(c){let p;try{p=JSON.parse(c)}catch{console.warn("Could not parse message",c);return}switch(console.log("[command]",p),p.t){case"alarms":ge.set(p.alarms);break;case"temperature":ye.set(p.temperature);break;case"steps":$e.set(p.steps);break;case"hrm":be.set(p.hrm);break}}async function u(){n(0,o=!0),(!r||!r.isOpen)&&(r=await qe(f));try{await Fe(r),await Je(r),await ze(r),await Ie(r,6e4),await Ze(r,s),n(2,a="Syncronized Successfully")}catch(c){n(2,a="Syncronization Failed"),console.error(c)}finally{n(0,o=!1)}}function i(c){s=c,n(1,s)}return[o,s,a,u,i]}class ot extends K{constructor(t){super(),T(this,t,st,rt,S,{})}}new ot({target:document.getElementById("app")});
